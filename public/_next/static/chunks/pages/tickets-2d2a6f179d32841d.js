(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[824],{9996:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets",function(){return a(9874)}])},9874:function(e,t,a){"use strict";a.r(t);var n=a(5034),r=a(169),s=a(2050),o=a(4246),i=a(7378),u=a(6249),c=a(66),l=a(4047),d=a(4862),m=a(4144),p=a(4506),f=a(7640),h=a(4644),g=a(7542),k=a(9895),x=a(9490),_=a(1529),j=a.n(_),S=a(1454),v=a(5218),y=a.n(v),P=a(8021),b=y()((function(){return a.e(648).then(a.t.bind(a,2648,23))}),{loadableGenerated:{webpack:function(){return[2648]}},ssr:!1}),N={id:function(e){return e.id},external_id:function(e){return e.external_id},username:function(e){return e.username},type:function(e){return e.type},time:function(e){return(0,k.formatTime)(e.time,e.intl)},amount_in:function(e){return(0,k.formatStake)(e.amount_in,e.intl)},amount_out:function(e){return(0,k.formatStake)(e.amount_out,e.intl)},status:function(e){return e.status}},D={active:function(e){return e.active},in:function(e){return(0,k.formatStake)(e.in,e.intl)},out:function(e){return(0,k.formatStake)(e.out,e.intl)},profit:function(e){return(0,k.formatStake)(e.profit,e.intl)},tickets:function(e){return e.tickets}},Z={id:function(e){return e.id},user_id:function(e){return e.user_id},type:function(e){return e.type},time:function(e){return(0,k.formatTime)(e.time,e.intl)},amount_in:function(e){return(0,k.formatStake)(e.amount_in,e.intl)},amount_out:function(e){return(0,k.formatStake)(e.amount_out,e.intl)},status:function(e){return e.status}},T={id:function(e){return e.id},user_id:function(e){return e.user_id},type:function(e){return e.type},time:function(e){return(0,k.formatTime)(e.time,e.intl)},amount_in:function(e){return(0,k.formatStake)(e.amount_in,e.intl)},amount_out:function(e){return(0,k.formatStake)(e.amount_out,e.intl)},status:function(e){return e.status}},C={concatPercentage:function(e){return(0,k.formatStake)(e.concatPercentage,e.intl)},sumIn:function(e){return(0,k.formatStake)(e.sumIn,e.intl)},sumOut:function(e){return(0,k.formatStake)(e.sumOut,e.intl)},shop_id:function(e){return e.shop_id}};t.default=function(e){var t=e.asidePanel,a=function(e){var t=e.itemId;w({isOpen:!0,title:v("ticket.panel.details")+t,content:(0,o.jsx)(l.AI,{ticketId:t})})},_=((0,P.a)({middleware:"auth"}).user,(0,g.X$)()),v=(0,k.useTranslation)("").t,y=(0,i.useContext)(u.Ni).isDarkMode,I=(0,i.useContext)(u.pI),w=I.openAsidePanel,M=I.closeAsidePanel,O=(0,s.Z)((0,i.useState)(10),2),E=O[0],B=(O[1],(0,s.Z)((0,i.useState)(!0),2)),A=B[0],H=B[1],R=(0,s.Z)((0,i.useState)([]),2),U=R[0],F=R[1],G=(0,s.Z)((0,i.useState)(),2),X=G[0],Y=G[1],$=(0,s.Z)((0,i.useState)({}),2),z=$[0],L=$[1],q=(0,s.Z)((0,i.useState)({}),2),J=q[0],K=q[1],Q=(0,s.Z)((0,i.useState)({}),2),V=Q[0],W=Q[1],ee=(0,s.Z)((0,i.useState)({type:"transaction",groupBy:"",fromDate:_,toDate:_,shops:[],users:[]}),2),te=ee[0],ae=ee[1],ne=(0,s.Z)((0,i.useState)(""),2),re=ne[0],se=ne[1],oe=(0,s.Z)((0,i.useState)({shops:"",users:"",type:"",fromDate:"",toDate:"",groupBy:""}),2),ie=(oe[0],oe[1],(0,s.Z)((0,i.useState)(!1),2)),ue=ie[0],ce=ie[1],le=(0,s.Z)((0,i.useState)(),2),de=le[0],me=le[1],pe=(0,i.useCallback)((function(e,t,a){H(!0);var s=(0,r.Z)((0,n.Z)({},te,a),{chunk:e,limit:t});if("transactionShops"!=re&&"transactionUsers"!=re||!a.shops)return(0,d.cl)({params:s,onSuccess:function(e){H(!1),se(e.mode),F(e.reports),K(e.totalSum),W(e.totalSumOfPerPage),Y(e.pagination),ae(e.params),(0,S.Am)("Tickets updated ",{hideProgressBar:!0,autoClose:2e3,type:"success"})},onError:function(e){H(!1),(0,S.Am)(e.message?e.message:v("error.tickets"),{hideProgressBar:!0,autoClose:2e3,type:"error"})}}),!0;var o={shop:[a.shops],type:"transaction",chunk:e,limit:t},i=re;return(0,d.cl)({params:o,onSuccess:function(e){H(!1),se(i),U[a.dataIndex]=e.reports,F(U),J.group[a.dataIndex]=e.totalSum,K(J),V.group[a.dataIndex]=e.totalSumOfPerPage,W(V),X.group[a.dataIndex]=e.pagination,Y(X),(0,S.Am)(v("Tickets updated for shop: ")+a.shops,{hideProgressBar:!0,autoClose:2e3,type:"success"})},onError:function(e){(0,S.Am)(e.message?e.message:v("errors.tickets"),{hideProgressBar:!0,autoClose:2e3,type:"error"})}}),!0}),[E,te]);(0,i.useCallback)((function(e){switch(H(!1),se(e.mode),F(e.reports),K(e.totalSum),W(e.totalSumOfPerPage),Y(e.pagination),ae(e.params),e.mode){case"summary":L(m.e0);break;case"transaction":L(m.Pe);break;case"summaryShops":L(m.YO);break;case"transactionShops":L(m.$_);break;case"transactionUsers":L(m.mx);break;case"summaryUsers":L(m.xL);break;default:console.log("default mode? ")}return!0}),[]);(0,i.useEffect)((function(){(0,d.cl)({params:te,onSuccess:function(e){H(!1),se(e.mode),F(e.reports),K(e.totalSum),W(e.totalSumOfPerPage),Y(e.pagination),ae(e.params),L(m.Pe)},onError:function(e){me(e&&e.message),ce(!0),H(!1),console.warn("ON ERROR",e);var t=e.message?e.message:v("error.data");(0,S.Am)(t,{hideProgressBar:!0,autoClose:2e3,type:"error"})}})}),[]),(0,i.useEffect)((function(){return function(){M&&M()}}),[M]);var fe=function(e){var t=new Date(e),a=""+(t.getMonth()+1),n=""+t.getDate(),r=t.getFullYear();return a.length<2&&(a="0"+a),n.length<2&&(n="0"+n),"".concat(a,"/").concat(n,"/").concat(r)},he=(0,i.useCallback)((function(e){ae((0,r.Z)((0,n.Z)({},te),{fromDate:fe(e)}))}),[te]),ge=(0,i.useCallback)((function(e){ae((0,r.Z)((0,n.Z)({},te),{toDate:fe(e)}))}),[te]);if(A)return(0,o.jsx)(p.Z,{});var ke="trasnsactionShops"===re||"transaction"===re||"trasnsactionUsers"===re?a:null;return(0,o.jsxs)(x.Z,{asidePanel:t,children:[(0,o.jsx)(j(),{children:(0,o.jsx)("title",{children:v("ticket.list.title")})}),(0,o.jsxs)("div",{className:"p-panel "+(y?"is-dark":""),children:[(0,o.jsxs)("div",{className:"row",children:[(0,o.jsx)("div",{className:"col-2 p-panel__header ",children:(0,o.jsx)("h4",{className:"p-panel__title",children:v("ticket.list.header")})}),(0,o.jsx)("div",{className:"col-10",children:(0,o.jsx)("div",{className:"p-panel__controls",children:(0,o.jsx)("div",{className:"p-form p-form--stacked",children:(0,o.jsxs)("div",{className:"p-form__group row",children:[(0,o.jsx)("div",{className:"col-1 u-align--center",children:(0,o.jsx)("label",{className:"p-form__label",children:v("ticket.from")})}),(0,o.jsx)("div",{className:"col-3",children:(0,o.jsx)("div",{className:"p-form__control",children:(0,o.jsx)(b,{className:"u-no-margin--bottom "+(y?"is-dark":""),dateFormat:"dd/MM/yyyy",selected:Date.parse((0,k.formatTime)(te.fromDate,{locale:"en_GB"})),maxDate:Date.parse(_),onChange:he})})}),(0,o.jsx)("div",{className:"col-1 u-align--center",children:(0,o.jsx)("label",{className:"p-form__label",children:v("ticket.to")})}),(0,o.jsx)("div",{className:"col-3",children:(0,o.jsx)("div",{className:"p-form__control",children:(0,o.jsx)(b,{className:"u-no-margin--bottom "+(y?"is-dark":""),dateFormat:"dd/MM/yyyy",selected:Date.parse((0,k.formatTime)(te.toDate,{locale:"en_GB"})),maxDate:Date.parse(_),onChange:ge})})}),(0,o.jsx)("div",{className:"col-2 u-align--center",children:(0,o.jsxs)(c.zx,{className:y?"is-dark":"",hasIcon:!0,onClick:function(e){e.preventDefault(),pe(1,E,te)},children:[(0,o.jsx)("i",{className:"p-icon--change-version"}),(0,o.jsx)("span",{children:v("ticket.button.update")})]})})]})})})})]}),(0,o.jsx)("div",{className:"p-panel__content",children:(0,o.jsx)("div",{className:"u-fixed-width",children:ue?(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(c.P_,{borderless:!0,className:y?"is-dark":"",severity:"negative",title:v("error.error"),children:de})}):(0,o.jsxs)(o.Fragment,{children:[0==U.length&&(0,o.jsx)(c.P_,{borderless:!0,severity:"information",title:v("error.warning"),className:y?"is-dark":"",children:v("error.no_result")}),U.length>0&&(0,o.jsxs)(o.Fragment,{children:["transactionUsers"==re&&(0,o.jsxs)("div",{children:[U.map((function(e,t){return(0,o.jsxs)("div",{children:[(0,o.jsx)(h.Z,{tableHeader:"User id: "+e[0].user_id+" Type: "+e[0].type,tableData:e,headers:z,onClickHandler:a,pageTotal:V.group[t],total:J.group[t],pagination:X.group[t],goToPage:pe,mode:re,itemId:e[0].user_id,dataIndex:t,cellRenderer:Z}),(0,o.jsx)("hr",{})]},t)})),(0,o.jsx)(f.Z,{chunk:X.chunk,last_chunk:X.last_chunk,total:X.total,limit:X.limit,goToPage:pe,displayedItems:U.length,isDarkMode:y})]}),"transactionShops"==re&&(0,o.jsxs)("div",{children:[U.map((function(e,t){return(0,o.jsxs)("div",{children:[(0,o.jsx)(h.Z,{tableHeader:"Shop: "+e[0].shop_id,tableData:e,headers:z,onClickHandler:a,pageTotal:V.group[t],total:J.group[t],pagination:X.group[t],goToPage:pe,mode:re,itemId:e[0].user_id,dataIndex:t,cellRenderer:T}),(0,o.jsx)("hr",{})]},t)})),(0,o.jsx)(f.Z,{chunk:X.chunk,last_chunk:X.last_chunk,total:X.total,limit:X.limit,goToPage:pe,displayedItems:U.length,isDarkMode:y})]}),"summary"==re&&(0,o.jsx)(h.Z,{tableData:U,headers:z,onClickHandler:ke,pageTotal:V,total:J,pagination:X,goToPage:pe,isDarkMode:y,cellRenderer:D}),"transaction"==re&&(0,o.jsx)(h.Z,{tableData:U,headers:z,onClickHandler:ke,pageTotal:V,total:J,pagination:X,goToPage:pe,isDarkMode:y,cellRenderer:N}),"summaryShops"==re&&(0,o.jsx)(h.Z,{tableData:U,headers:z,onClickHandler:ke,pageTotal:V,total:J,pagination:X,goToPage:pe,isDarkMode:y,cellRenderer:C}),"summaryUsers"==re&&(0,o.jsx)(h.Z,{tableData:U,headers:z,onClickHandler:ke,pageTotal:V,total:J,pagination:X,goToPage:pe,isDarkMode:y})]})]})})})]})]})}}},function(e){e.O(0,[969,863,974,486,509,774,888,179],(function(){return t=9996,e(e.s=t);var t}));var t=e.O();_N_E=t}]);